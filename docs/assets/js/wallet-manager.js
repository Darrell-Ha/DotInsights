!function(d){"use strict";window.DotInsights=window.DotInsights||{},DotInsights.Wallet={isInstalled:!1,isConnected:!1},DotInsights.VotedProjects=[];var r=DotInsights.Helpers;const u="walletInfo";var g=d("#modal-connect-wallet"),c=g.find(".modal-content-body");g.DotInsightsModal(),d(document).ready(function(){setTimeout(async()=>{var t=o("subwallet-js");t&&(DotInsights.ActiveWallet=await t.enable().catch(()=>{alert("User cancel or reject connect request")}))}),d(document.body).on("click",".btn-connect-subwallet",function(t){t.preventDefault(),setTimeout(async()=>{var t,e;o("subwallet-js")?(t=(e=await DotInsights.ActiveWallet.accounts.get())[0].address,e={accounts:e,selectedAccount:e[0],selectedAccountAddress:t},window.localStorage.setItem(u,JSON.stringify(e)),s()):alert("SubWallet extension is not installed")},300)}),s()}),d(document.body).on("click",".btn-logout-subwallet",function(){window.localStorage.removeItem(u),s()}),d(document.body).on("click",".btn-vote",function(t){t.preventDefault();var c=d(this),l=c.data("project-id");if(DotInsights.Wallet.isConnected){const i=JSON.parse(localStorage.getItem(u));r.setElementHandling(c),!async function(){try{n=i.selectedAccountAddress,a=await async function(t,e){var s=await async function(t){t=await h(r.getApiEndpointUrl("getMessage"),{address:t});return t.message}(t);s+="-"+e;e=await DotInsights.ActiveWallet.signer.signRaw({address:t,data:s});return e.signature}(n,o=l);var t,e=await h(r.getApiEndpointUrl("toggleVoteProject"),{project_id:o,address:n,signature:a}),s=(r.unsetElementHandling(c),DotInsights.Projects=DotInsights.Projects.map(t=>t.project_id===l?{...t,vote_count:e.vote_count}:t),d('.btn-vote[data-project-id="'+l+'"]'));s.find(".button-text").text(e.vote_count),e.isVote?(s.removeClass("vote-this").addClass("unvote-this"),DotInsights.VotedProjects.length<1&&d("#modal-first-vote-notice").DotInsightsModal("open"),-1===DotInsights.VotedProjects.indexOf(l)&&DotInsights.VotedProjects.push(l)):(s.removeClass("unvote-this").addClass("vote-this"),-1<(t=DotInsights.VotedProjects.indexOf(l))&&DotInsights.VotedProjects.splice(t,1))}catch(t){r.unsetElementHandling(c)}var n,o,a}()}else g.DotInsightsModal("open")}),d(document.body).on("click",".wallet-account-address",function(t){if(t.preventDefault(),!d(this).hasClass("selected-account")){var e=d(this).data("address");try{for(var s=JSON.parse(localStorage.getItem(u)),n=0;n<s.accounts.length;n++)if(e===s.accounts[n].address){s.selectedAccountAddress=e,s.selectedAccount=s.accounts[n],localStorage.setItem(u,JSON.stringify(s)),d(this).siblings().removeClass("selected-account"),d(this).addClass("selected-account"),g.DotInsightsModal("close"),d(".btn-open-connect-wallet").find(".button-text span").text(s.selectedAccount.name),l(e);break}}catch(t){console.log(t)}}});const s=()=>{var t;DotInsights.Wallet.isInstalled=Boolean(window.injectedWeb3&&window.SubWallet),DotInsights.Wallet.isConnected=e(),DotInsights.Wallet.isInstalled?DotInsights.Wallet.isInstalled&&!DotInsights.Wallet.isConnected?(c.empty(),c.html(`
					<a href="#" target="_blank" class="button button-right-icon btn-connect-subwallet">
						<span class="button-text">SubWallet</span>
					</a>
				`)):(t=JSON.parse(localStorage.getItem(u)),n(t)):(t="https://bit.ly/3BGqFt1",DotInsights.BrowserUtil.isFirefox&&(t="https://mzl.la/3rQ0awW"),c.empty(),c.html(`
					<a href="${t}" target="_blank" class="button button-right-icon btn-install-subwallet">
						<span class="button-text">SubWallet</span>
						<span class="button-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.0625 10.3135L12 14.2499L15.9375 10.3135" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 3.75V14.2472" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M20.25 14.25V19.5C20.25 19.6989 20.171 19.8897 20.0303 20.0303C19.8897 20.171 19.6989 20.25 19.5 20.25H4.5C4.30109 20.25 4.11032 20.171 3.96967 20.0303C3.82902 19.8897 3.75 19.6989 3.75 19.5V14.25" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
					</a>
				`))},e=()=>{try{var t=JSON.parse(localStorage.getItem(u));return t.hasOwnProperty("selectedAccount")?!!t:!1}catch(t){return!1}},n=(t=null)=>{for(var e=t||JSON.parse(localStorage.getItem(u)),s="",n=0;n<e.accounts.length;n++){var o=e.accounts[n],a="wallet-account-address";s+=`<div class="${a+=o.address===e.selectedAccountAddress?" selected-account":""}" data-address="${o.address}">
								<div class="wallet-icon"><img src="./assets/images/wallet-icon.png" alt=""></div>
                                <div id="wallet-info">
                                    <div class="wallet-name">${o.name}</div>
                                    <div class="wallet-address"><span>${o.address}</span></div>
                                </div>
							</div>`}d(".btn-open-connect-wallet").find(".button-text span").text(e.selectedAccount.name),g.find(".modal-title").text("Choose account"),c.empty(),c.html(s),l(e.selectedAccountAddress)};function l(t){d.ajax({method:"POST",url:r.getApiEndpointUrl("getVotedProject"),data:{address:t},success:function(t){DotInsights.VotedProjects=t,d(document.body).trigger("DotInsights/VotedProjects/Refreshed")}})}function o(t){return window.injectedWeb3&&window.injectedWeb3[t]}async function h(n,o){return new Promise((t,e)=>{const s=new XMLHttpRequest;s.open("POST",n),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json"),s.onload=()=>{t(JSON.parse(s.responseText))};try{s.send(JSON.stringify(o))}catch(t){console.error(t),e(t)}})}d(document.body).on("DotInsights/VotedProjects/Refreshed",function(){if(d(".btn-vote").addClass("vote-this").removeClass("unvote-this"),0<DotInsights.VotedProjects.length)for(var t=0;t<DotInsights.VotedProjects.length;t++)d('.btn-vote[data-project-id="'+DotInsights.VotedProjects[t]+'"]').removeClass("vote-this").addClass("unvote-this")})}(jQuery);