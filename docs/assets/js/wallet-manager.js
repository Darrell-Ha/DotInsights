!function(o){"use strict";window.DotInsights=window.DotInsights||{},DotInsights.Wallet={isInstalled:!1,isConnected:!1},DotInsights.VotedProjects=[];var n=DotInsights.Helpers;const a="userAccount";var e=o("#modal-connect-wallet"),s=e.find(".modal-content-body");e.DotInsightsModal(),console.log("Ver 3.0"),o(document).ready(function(){t()}),o(document.body).on("click",".btn-connect-subwallet",function(t){t.preventDefault(),setTimeout(async()=>{var t,e,s=window.injectedWeb3&&window.injectedWeb3["subwallet-js"];s?(t=await(s=await s.enable().catch(()=>{alert("User cancel or reject connect request")})).accounts.get(),console.log(s),console.log(t),e=t[0].address,console.log(t),t=await async function(t){t=await d(n.getApiEndpointUrl("getMessage"),{address:t});return t.message}(e),console.log("SignMessage:",t),e={selectedAccountAddress:e,signature:(s=await s.signer.signRaw({address:e,data:t})).signature},window.localStorage.setItem(a,JSON.stringify(e)),console.log("Signature:",s.signature)):alert("SubWallet extension is not installed")},300)}),o(document.body).on("click",".btn-logout-subwallet",function(){window.localStorage.removeItem(a),t()}),o(document.body).on("click",".btn-vote",function(t){t.preventDefault();var s=o(this).data("project-id");DotInsights.Wallet.isConnected?(t=JSON.parse(localStorage.getItem(a)),o.ajax({method:"POST",url:n.getApiEndpointUrl("toggleVoteProject"),data:{project_id:s,address:t.selectedAccountAddress,signature:t.signature},success:function(e){DotInsights.Projects=DotInsights.Projects.map(t=>t.project_id===s?{...t,vote_count:e.vote_count}:t);var t=o('.btn-vote[data-project-id="'+s+'"]');t.find(".button-text").text(e.vote_count),e.isVote?(t.removeClass("vote-this").addClass("unvote-this"),-1===DotInsights.VotedProjects.indexOf(s)&&DotInsights.VotedProjects.push(s)):(t.removeClass("unvote-this").addClass("vote-this"),-1<(t=DotInsights.VotedProjects.indexOf(s))&&DotInsights.VotedProjects.splice(t,1))}})):e.DotInsightsModal("open")});const t=()=>{var t;DotInsights.Wallet.isInstalled=Boolean(window.injectedWeb3&&window.SubWallet),DotInsights.Wallet.isConnected=l(),DotInsights.Wallet.isInstalled?DotInsights.Wallet.isInstalled&&!DotInsights.Wallet.isConnected?(s.empty(),s.html(`
					<a href="#" target="_blank" class="button button-right-icon btn-connect-subwallet">
						<span class="button-text">SubWallet</span>
					</a>`)):(t=JSON.parse(localStorage.getItem(a)),i(t)):(t="https://bit.ly/3BGqFt1",DotInsights.BrowserUtil.isFirefox&&(t="https://mzl.la/3rQ0awW"),s.empty(),s.html(`
					<a href="${t}" target="_blank" class="button button-right-icon btn-install-subwallet">
						<span class="button-text">SubWallet</span>
						<span class="button-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.0625 10.3135L12 14.2499L15.9375 10.3135" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 3.75V14.2472" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M20.25 14.25V19.5C20.25 19.6989 20.171 19.8897 20.0303 20.0303C19.8897 20.171 19.6989 20.25 19.5 20.25H4.5C4.30109 20.25 4.11032 20.171 3.96967 20.0303C3.82902 19.8897 3.75 19.6989 3.75 19.5V14.25" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
					</a>
				`))},l=()=>{return!!JSON.parse(localStorage.getItem(a))},i=(t=null)=>{var t=t||JSON.parse(localStorage.getItem(a)),e=`<div class="connected-wallet-info-card">
								<div class="wallet-address-heading">Your address:</div>
                                <div class="wallet-address">
                                    <div class="wallet-icon"></div>
                                    <div id="wallet-account-address"><span>${t.selectedAccountAddress}</span></div>
                                    <a href="#" class="button btn-logout-subwallet"><span class="button-text">Log out</span></a>
                                </div>
							</div>`;s.empty(),s.html(e),o.ajax({method:"POST",url:n.getApiEndpointUrl("getVotedProject"),data:{address:t.selectedAccountAddress},success:function(t){DotInsights.VotedProjects=t,o(document.body).trigger("DotInsights/VotedProjects/Refreshed")}})};async function d(o,n){return new Promise((t,e)=>{const s=new XMLHttpRequest;s.open("POST",o),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json"),s.onload=()=>{t(JSON.parse(s.responseText))};try{s.send(JSON.stringify(n))}catch(t){console.error(t),e(t)}})}o(document.body).on("DotInsights/VotedProjects/Refreshed",function(){if(o(".btn-vote").removeClass("unvote-this"),0<DotInsights.VotedProjects.length)for(var t=0;t<DotInsights.VotedProjects.length;t++)o('.btn-vote[data-project-id="'+DotInsights.VotedProjects[t]+'"]').removeClass("vote-this").addClass("unvote-this")})}(jQuery);