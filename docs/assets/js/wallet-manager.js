!function(p){"use strict";window.dotinsights=window.dotinsights||{},dotinsights.VotedProjects=[];var v=dotinsights.Helpers;const e="walletInfo";var i=p("#modal-connect-wallet"),c=i.find(".modal-content-body"),n=(i.dotinsightsModal(),p(document).ready(function(){setTimeout(async()=>{var t=a();t&&(dotinsights.ActiveWallet=await t.enable().catch(()=>{alert("User cancel or reject connect request")}))}),p(document.body).on("click","#btn-connect-subwallet",function(t){t.preventDefault(),t=p(this),a()?(v.setElementHandling(t),setTimeout(async function(){var t=await dotinsights.ActiveWallet.accounts.get(),e=t[0].address;await w({accounts:t,selectedAccount:t[0],selectedAccountAddress:e}),o()},500)):alert("SubWallet extension is not installed")}),o()}),p(document.body).on("click",".btn-logout-subwallet",function(t){t=p(t.currentTarget);v.setElementHandling(t),setTimeout(async function(){window.localStorage.removeItem(e),o()},500)}),Date.UTC(2022,10,18,12,0,0)),s=p("#modal-vote-coming");p(document.body).on("click",".btn-vote",function(t){if(t.preventDefault(),n>Date.now())s.dotinsightsModal("open");else{var u=p(this),h=u.data("project-id");if(d()){const g=f();v.setElementHandling(u),!async function(){try{d=g.selectedAccountAddress,l=await async function(t,e){var n=f();for(var s="",o=0;o<n.accounts.length;o++)if(n.accounts[o].address===t){n.accounts[o].hasOwnProperty("signMessage")?s=n.accounts[o].signMessage:(s=await async function(t){t=await b(v.getApiEndpointUrl("getMessage"),{address:t});return t.message}(t),n.accounts[o].signMessage=s,w(n));break}s+="-"+e;e=await dotinsights.ActiveWallet.signer.signRaw({address:t,data:s});return e.signature}(d,r=h);var t,e,n,s,o,a,i,c=await b(v.getApiEndpointUrl("toggleVoteProject"),{project_id:r,address:d,signature:l});v.unsetElementHandling(u),c.hasOwnProperty("vote_count")?(dotinsights.Projects=dotinsights.Projects.map(t=>t.project_id===h?{...t,vote_count:c.vote_count}:t),(t=p('.btn-vote[data-project-id="'+h+'"]')).find(".button-text").text(c.vote_count),c.isVote?(t.removeClass("vote-this").addClass("unvote-this"),dotinsights.VotedProjects.length<1&&(n=(e=p("#modal-first-vote-notice")).find(".btn-twitter-share"),s=`I love ${u.closest(".row-project").find(".project-name").text()} so much I voted for this project on the @Polkadot and @Kusamanetwork Ecosystem Map by @dotinsights! What about you? Come vote for your favorite projects and earn a free NFTðŸŽ‰`,o=(o=(o="https://twitter.com/share?text={text}&amp;url={url}").replace("{text}",s)).replace("{url}",location.origin),n.attr("href",encodeURI(o)),e.dotinsightsModal("open")),-1===dotinsights.VotedProjects.indexOf(h)&&dotinsights.VotedProjects.push(h)):(t.removeClass("unvote-this").addClass("vote-this"),-1<(a=dotinsights.VotedProjects.indexOf(h))&&dotinsights.VotedProjects.splice(a,1))):((i=p("#modal-vote-error")).find(".vote-error-message").text(c.message),i.dotinsightsModal("open"))}catch(t){v.unsetElementHandling(u)}var d,r,l}()}else i.dotinsightsModal("open")}}),p(document.body).on("click",".wallet-account-address",function(t){if(t.preventDefault(),!p(this).hasClass("selected-account")){var e=p(this).data("address");try{for(var n=f(),s=0;s<n.accounts.length;s++)if(e===n.accounts[s].address){n.selectedAccountAddress=e,n.selectedAccount=n.accounts[s],w(n),p(this).siblings().removeClass("selected-account"),p(this).addClass("selected-account"),i.dotinsightsModal("close"),p(".btn-open-connect-wallet").find(".button-text span").text(n.selectedAccount.name),r(e);break}}catch(t){console.error(t)}}});const o=()=>{if(void 0!==window.injectedWeb3&&void 0!==window.injectedWeb3["subwallet-js"])if(d()){var t=f(),e="";if(t&&void 0!==t.accounts&&0<t.accounts.length){for(var n=0;n<t.accounts.length;n++){var s=t.accounts[n],o="wallet-account-address";e+=`<div class="${o+=s.address===t.selectedAccountAddress?" selected-account":""}" data-address="${s.address}">
									<div class="wallet-icon"></div>
	                                <div id="wallet-info">
	                                    <div class="wallet-name">${s.name}</div>
	                                    <div class="wallet-address"><span>${s.address}</span></div>
	                                </div>
								</div>`}e+='<div class="button-wrap btn-logout-subwallet-wrap"><a href="#" class="button btn-logout-subwallet"><span class="button-text">Disconnect</span></a></div>'}else e="<div>There is not any accounts found.</div>";void 0!==t.selectedAccount.name&&p(".btn-open-connect-wallet").find(".button-text span").text(t.selectedAccount.name),i.find(".modal-title").text("Choose account"),c.empty(),c.html(e),r(t.selectedAccountAddress)}else c.empty(),c.html(`
						<a href="#" target="_blank" class="button button-right-icon btn-install-connect-wallet" id="btn-connect-subwallet">
							<span class="button-text">SubWallet</span>
						</a>
					`),p(".btn-open-connect-wallet").find(".button-text span").text("Connect Wallet"),i.find(".modal-title").text("Connect Your Wallet");else{var a="https://bit.ly/3BGqFt1";dotinsights.BrowserUtil.isFirefox&&(a="https://mzl.la/3rQ0awW"),c.empty(),c.html(`
					<a href="${a}" target="_blank" class="button button-right-icon btn-install-connect-wallet">
						<span class="button-text">SubWallet</span>
						<span class="button-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.0625 10.3135L12 14.2499L15.9375 10.3135" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 3.75V14.2472" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M20.25 14.25V19.5C20.25 19.6989 20.171 19.8897 20.0303 20.0303C19.8897 20.171 19.6989 20.25 19.5 20.25H4.5C4.30109 20.25 4.11032 20.171 3.96967 20.0303C3.82902 19.8897 3.75 19.6989 3.75 19.5V14.25" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
					</a>
				`)}},d=()=>{try{var t=f();return t.hasOwnProperty("selectedAccount")?!!t:!1}catch(t){return!1}};function r(t){p.ajax({method:"POST",url:v.getApiEndpointUrl("getVotedProject"),data:{address:t},success:function(t){dotinsights.VotedProjects=t,p(document.body).trigger("dotinsights/VotedProjects/Refreshed")}})}function a(t="subwallet-js"){return window.injectedWeb3&&window.injectedWeb3[t]}async function w(t){window.localStorage.setItem(e,JSON.stringify(t))}function f(){return JSON.parse(localStorage.getItem(e))}async function b(s,o){return new Promise((t,e)=>{const n=new XMLHttpRequest;n.open("POST",s),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),n.onload=()=>{t(JSON.parse(n.responseText))};try{n.send(JSON.stringify(o))}catch(t){console.error(t),e(t)}})}p(document.body).on("dotinsights/VotedProjects/Refreshed",function(){if(p(".btn-vote").addClass("vote-this").removeClass("unvote-this"),0<dotinsights.VotedProjects.length)for(var t=0;t<dotinsights.VotedProjects.length;t++)p('.btn-vote[data-project-id="'+dotinsights.VotedProjects[t]+'"]').removeClass("vote-this").addClass("unvote-this")})}(jQuery);