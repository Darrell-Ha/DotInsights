!function(g){"use strict";window.DotInsights=window.DotInsights||{},DotInsights.Wallet={isInstalled:!1,isConnected:!1},DotInsights.VotedProjects=[];var p=DotInsights.Helpers;const e="walletInfo";var c=g("#modal-connect-wallet"),i=c.find(".modal-content-body");c.DotInsightsModal(),g(document).ready(function(){DotInsights.Wallet.isInstalled=void 0!==window.injectedWeb3&&void 0!==window.injectedWeb3["subwallet-js"],DotInsights.Wallet.isConnected=t(),setTimeout(async()=>{var t=n();t&&(DotInsights.ActiveWallet=await t.enable().catch(()=>{alert("User cancel or reject connect request")}))}),g(document.body).on("click","#btn-connect-subwallet",function(t){t.preventDefault(),setTimeout(async()=>{var t,e;n()?(e=(t=await DotInsights.ActiveWallet.accounts.get())[0].address,v({accounts:t,selectedAccount:t[0],selectedAccountAddress:e}),s()):alert("SubWallet extension is not installed")},300)}),s()}),g(document.body).on("click",".btn-logout-subwallet",function(){window.localStorage.removeItem(e),s()}),g(document.body).on("click",".btn-vote",function(t){t.preventDefault();var r=g(this),u=r.data("project-id");if(DotInsights.Wallet.isConnected){const h=w();p.setElementHandling(r),!async function(){try{i=h.selectedAccountAddress,d=await async function(t,e){var s=w();for(var n="",o=0;o<s.accounts.length;o++)if(s.accounts[o].address===t){s.accounts[o].hasOwnProperty("signMessage")?n=s.accounts[o].signMessage:(n=await async function(t){t=await f(p.getApiEndpointUrl("getMessage"),{address:t});return t.message}(t),s.accounts[o].signMessage=n,v(s));break}n+="-"+e;e=await DotInsights.ActiveWallet.signer.signRaw({address:t,data:n});return e.signature}(i,l=u);var t,e,s,n,o,a=await f(p.getApiEndpointUrl("toggleVoteProject"),{project_id:l,address:i,signature:d}),c=(p.unsetElementHandling(r),DotInsights.Projects=DotInsights.Projects.map(t=>t.project_id===u?{...t,vote_count:a.vote_count}:t),g('.btn-vote[data-project-id="'+u+'"]'));c.find(".button-text").text(a.vote_count),a.isVote?(c.removeClass("vote-this").addClass("unvote-this"),DotInsights.VotedProjects.length<1&&(e=(t=g("#modal-first-vote-notice")).find(".btn-twitter-share"),s=`I voted for ${r.closest(".row-project").find(".project-name").text()} on dotinsights, what about you? Vote for your favorite projects in the @Polkadot and @kusamanetwork ecosystem now`,n=(n=(n="https://twitter.com/share?text={text}&amp;url={url}").replace("{text}",s)).replace("{url}",location.origin),e.attr("href",encodeURI(n)),t.DotInsightsModal("open")),-1===DotInsights.VotedProjects.indexOf(u)&&DotInsights.VotedProjects.push(u)):(c.removeClass("unvote-this").addClass("vote-this"),-1<(o=DotInsights.VotedProjects.indexOf(u))&&DotInsights.VotedProjects.splice(o,1))}catch(t){p.unsetElementHandling(r)}var i,l,d}()}else c.DotInsightsModal("open")}),g(document.body).on("click",".wallet-account-address",function(t){if(t.preventDefault(),!g(this).hasClass("selected-account")){var e=g(this).data("address");try{for(var s=w(),n=0;n<s.accounts.length;n++)if(e===s.accounts[n].address){s.selectedAccountAddress=e,s.selectedAccount=s.accounts[n],v(s),g(this).siblings().removeClass("selected-account"),g(this).addClass("selected-account"),c.DotInsightsModal("close"),g(".btn-open-connect-wallet").find(".button-text span").text(s.selectedAccount.name),l(e);break}}catch(t){console.error(t)}}});const s=()=>{if(DotInsights.Wallet.isInstalled)if(DotInsights.Wallet.isConnected){var t=w(),e="";if(void 0!==t.accounts&&0<t.accounts.length){for(var s=0;s<t.accounts.length;s++){var n=t.accounts[s],o="wallet-account-address";e+=`<div class="${o+=n.address===t.selectedAccountAddress?" selected-account":""}" data-address="${n.address}">
									<div class="wallet-icon"><img src="./assets/images/wallet-icon.png" alt=""></div>
	                                <div id="wallet-info">
	                                    <div class="wallet-name">${n.name}</div>
	                                    <div class="wallet-address"><span>${n.address}</span></div>
	                                </div>
								</div>`}e+='<div class="button-wrap btn-logout-subwallet-wrap"><a href="#" class="button btn-logout-subwallet"><span class="button-text">Disconnect</span></a></div>'}else e="<div>There is not any accounts found.</div>";void 0!==t.selectedAccount.name&&g(".btn-open-connect-wallet").find(".button-text span").text(t.selectedAccount.name),c.find(".modal-title").text("Choose account"),i.empty(),i.html(e),l(t.selectedAccountAddress)}else i.empty(),i.html(`
					<a href="#" target="_blank" class="button button-right-icon btn-install-connect-wallet" id="btn-connect-subwallet">
						<span class="button-text">SubWallet</span>
					</a>
				`);else{var a="https://bit.ly/3BGqFt1";DotInsights.BrowserUtil.isFirefox&&(a="https://mzl.la/3rQ0awW"),i.empty(),i.html(`
					<a href="${a}" target="_blank" class="button button-right-icon btn-install-connect-wallet">
						<span class="button-text">SubWallet</span>
						<span class="button-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.0625 10.3135L12 14.2499L15.9375 10.3135" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 3.75V14.2472" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M20.25 14.25V19.5C20.25 19.6989 20.171 19.8897 20.0303 20.0303C19.8897 20.171 19.6989 20.25 19.5 20.25H4.5C4.30109 20.25 4.11032 20.171 3.96967 20.0303C3.82902 19.8897 3.75 19.6989 3.75 19.5V14.25" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
					</a>
				`)}},t=()=>{try{var t=w();return t.hasOwnProperty("selectedAccount")?!!t:!1}catch(t){return!1}};function l(t){g.ajax({method:"POST",url:p.getApiEndpointUrl("getVotedProject"),data:{address:t},success:function(t){DotInsights.VotedProjects=t,g(document.body).trigger("DotInsights/VotedProjects/Refreshed")}})}function n(t="subwallet-js"){return window.injectedWeb3&&window.injectedWeb3[t]}function v(t){window.localStorage.setItem(e,JSON.stringify(t))}function w(){return JSON.parse(localStorage.getItem(e))}async function f(n,o){return new Promise((t,e)=>{const s=new XMLHttpRequest;s.open("POST",n),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json"),s.onload=()=>{t(JSON.parse(s.responseText))};try{s.send(JSON.stringify(o))}catch(t){console.error(t),e(t)}})}g(document.body).on("DotInsights/VotedProjects/Refreshed",function(){if(g(".btn-vote").addClass("vote-this").removeClass("unvote-this"),0<DotInsights.VotedProjects.length)for(var t=0;t<DotInsights.VotedProjects.length;t++)g('.btn-vote[data-project-id="'+DotInsights.VotedProjects[t]+'"]').removeClass("vote-this").addClass("unvote-this")})}(jQuery);